<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 10px;
    }
    
    .header-bar h1 {
      margin: 0;
    }
    
    .user-menu {
      position: relative;
    }
    
    .user-button {
      background: #0f172a;
      border: 1px solid #334155;
      color: #e5e7eb;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .user-button:hover {
      background: #1e293b;
      border-color: #38bdf8;
    }
    
    .premium-badge {
      background: #facc15;
      color: #000;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 8px;
      background: #020617;
      border: 1px solid #334155;
      border-radius: 8px;
      min-width: 200px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 1000;
    }
    
    .dropdown-menu.show {
      display: block;
    }
    
    .dropdown-item {
      padding: 12px 16px;
      color: #e5e7eb;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #1e293b;
    }
    
    .dropdown-item:last-child {
      border-bottom: none;
    }
    
    .dropdown-item:hover {
      background: #1e293b;
    }
    
    .login-button {
      background: #38bdf8;
      color: #000;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
    }
    
    .login-button:hover {
      background: #7dd3fc;
    }
    
    .no-matches {
      background: #020617;
      border-radius: 12px;
      padding: 60px 30px;
      text-align: center;
      margin: 40px 0;
    }
    
    .no-matches h2 {
      color: #facc15;
      margin-bottom: 16px;
    }
    
    .no-matches p {
      color: #94a3b8;
      margin-bottom: 24px;
    }
    
    .refresh-btn {
      background: #38bdf8;
      color: #000;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
    }
    
    .refresh-btn:hover {
      background: #7dd3fc;
    }
    
    .premium-picks-lock {
      text-align: center;
      padding: 40px 20px;
      background: #0f172a;
      border-radius: 8px;
      margin-top: 12px;
    }
    
    .free-badge {
      background: #10b981;
      color: #fff;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
      margin-left: 8px;
    }
  </style>
</head>
<body>

<div class="header-bar">
  <h1>ğŸ“… BugÃ¼nÃ¼n MaÃ§larÄ±</h1>
  
  <div class="user-menu">
    {% if user %}
      <button class="user-button" onclick="toggleMenu()">
        <span>{{ user.email.split('@')[0] }}</span>
        {% if user.is_premium %}
          <span class="premium-badge">â­ PRO</span>
        {% endif %}
        <span>â–¼</span>
      </button>
      
      <div class="dropdown-menu" id="userDropdown">
        <a href="/account" class="dropdown-item">
          <span>ğŸ‘¤</span>
          <span>HesabÄ±m</span>
        </a>
        {% if user.is_premium %}
        <a href="/account" class="dropdown-item">
          <span>â­</span>
          <span>Premium Bilgileri</span>
        </a>
        {% else %}
        <a href="/payment" class="dropdown-item">
          <span>ğŸ”“</span>
          <span>Premium Ol</span>
        </a>
        {% endif %}
        <a href="/logout" class="dropdown-item" style="color: #f87171;">
          <span>ğŸšª</span>
          <span>Ã‡Ä±kÄ±ÅŸ Yap</span>
        </a>
      </div>
    {% else %}
      <a href="/login" class="login-button">GiriÅŸ Yap</a>
    {% endif %}
  </div>
</div>

{% if matches and matches|length > 0 %}
  {% for league, league_matches in matches.items() %}
  <div class="league-card">
    <h2>{{ league }}</h2>

    <div class="table header">
      <div class="cell match">MaÃ§</div>
      <div class="cell">MS1</div>
      <div class="cell">MS0</div>
      <div class="cell">MS2</div>
      <div class="cell">O2.5</div>
      <div class="cell">KG</div>
      <div class="cell">Ä°Y 1.5</div>
    </div>

    {% for match in league_matches %}
    <div class="match-row {% if not match.is_free and not is_premium %}locked{% endif %}">

      <div class="cell match">
        {{ match.homeTeam.name }} - {{ match.awayTeam.name }}
        <span class="time">{{ match.time }}</span>
        {% if match.is_free and not is_premium %}
          <span class="free-badge">ğŸ ÃœCRETSÄ°Z</span>
        {% endif %}
      </div>

      {% for key in ["MS1","MS0","MS2","O25","KG","FH15"] %}
      <div class="cell {% if not match.is_free and not is_premium %}blur{% endif %}">
        {{ match.markets[key] }}%
        {% if match.markets.best == key and match.markets.best_value >= 65 %}
          {% if match.is_free or is_premium %}
            <span class="star">â­</span>
          {% endif %}
        {% endif %}
      </div>
      {% endfor %}

      {% if not match.is_free and not is_premium %}
      <div class="premium-overlay">
        {% if not user %}
        <a href="/register" class="premium-btn">ğŸ”’ Premium</a>
        {% else %}
        <a href="/payment" class="premium-btn">ğŸ”’ Premium</a>
        {% endif %}
      </div>
      {% endif %}

    </div>
    {% endfor %}
  </div>
  {% endfor %}

  {% if picks and picks|length > 0 %}
  <div class="picks">
    <h2>ğŸ”¥ GÃ¼nÃ¼n Oynanabilir Tercihleri</h2>
    
    {% if is_premium %}
      <ul>
        {% for p in picks %}
        <li>
          <strong>{{ p.match }}</strong> â†’ {{ p.market }} (%{{ p.value }})
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <!-- Free kullanÄ±cÄ±lar iÃ§in en iyi 2-3 tahmini gÃ¶ster -->
      {% set sorted_picks = picks|sort(attribute='value', reverse=True) %}
      {% set free_picks = sorted_picks[:free_count] %}
      
      {% if free_picks %}
      <div style="background: #064e3b; border: 2px solid #10b981; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
        <h3 style="color: #10b981; margin-bottom: 16px;">ğŸ Ãœcretsiz Tahminler</h3>
        <ul style="margin: 0;">
          {% for p in free_picks %}
          <li style="margin-bottom: 8px;">
            <strong>{{ p.match }}</strong> â†’ {{ p.market }} (%{{ p.value }})
            <span class="free-badge">ÃœCRETSÄ°Z</span>
          </li>
          {% endfor %}
        </ul>
        <p style="margin-top: 16px; font-size: 14px; opacity: 0.9;">
          âœ… Bu tahminler size Ã¼cretsiz sunuldu! DevamÄ± iÃ§in Premium olun.
        </p>
      </div>
      {% endif %}
      
      <div class="premium-picks-lock">
        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”’</div>
        <h3 style="color: #facc15; margin-bottom: 12px;">Premium Tahmin</h3>
        <p style="opacity: 0.8; margin-bottom: 20px;">
          GÃ¼nÃ¼n en iyi bahis Ã¶nerilerini gÃ¶rmek iÃ§in Premium Ã¼yeliÄŸe geÃ§in
        </p>
        {% if not user %}
        <a href="/register" class="premium-btn" style="padding: 12px 24px; font-size: 14px; display: inline-block;">
          â­ Premium Ãœye Ol
        </a>
        {% else %}
        <a href="/payment" class="premium-btn" style="padding: 12px 24px; font-size: 14px; display: inline-block;">
          â­ Premium Ãœye Ol
        </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  {% endif %}

{% else %}
  <div class="no-matches">
    <h2>âš½ BugÃ¼n MaÃ§ Yok</h2>
    <p>SeÃ§ili liglerde bugÃ¼n oynanacak maÃ§ bulunmamaktadÄ±r.</p>
    <p style="font-size: 14px; opacity: 0.7;">YarÄ±n tekrar kontrol edin veya sayfayÄ± yenileyebilirsiniz.</p>
    <a href="/refresh" class="refresh-btn">ğŸ”„ Yenile</a>
  </div>
{% endif %}

<script>
function toggleMenu() {
  const dropdown = document.getElementById('userDropdown');
  dropdown.classList.toggle('show');
}

document.addEventListener('click', function(event) {
  const userMenu = document.querySelector('.user-menu');
  if (!userMenu.contains(event.target)) {
    document.getElementById('userDropdown')?.classList.remove('show');
  }
});

if (!document.querySelector('meta[name="viewport"]')) {
  const meta = document.createElement('meta');
  meta.name = 'viewport';
  meta.content = 'width=device-width, initial-scale=1.0, maximum-scale=5.0';
  document.head.appendChild(meta);
}
</script>

</body>
</html>

<footer style="text-align: center; padding: 30px 20px; margin-top: 60px; border-top: 1px solid #334155;">
  <p style="opacity: 0.8; margin-bottom: 8px;">
    Â© 2025 Ekinci Analiz - Premium Futbol Analiz Platformu
  </p>
  <p style="font-size: 14px; opacity: 0.7;">
    Åikayet ve Ã–neriler: <a href="mailto:ekincianaliz@gmail.com" style="color: #38bdf8; text-decoration: none;">ekincianaliz@gmail.com</a>
  </p>
</footer>
